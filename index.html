<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout</title>

    <script src="https://telegram.org/js/telegram-web-app.js?59"></script>

    <style>
        html, body, div, span, applet, object, iframe,
        h1, h2, h3, h4, h5, h6, p, blockquote, pre,
        a, abbr, acronym, address, big, cite, code,
        del, dfn, em, img, ins, kbd, q, s, samp,
        small, strike, strong, sub, sup, tt, var,
        b, u, i, center,
        dl, dt, dd, ol, ul, li,
        fieldset, form, label, legend,
        table, caption, tbody, tfoot, thead, tr, th, td,
        article, aside, canvas, details, embed, 
        figure, figcaption, footer, header, hgroup, 
        menu, nav, output, ruby, section, summary,
        time, mark, audio, video {
            margin: 0;
            padding: 0;
            border: 0;
            font-size: 100%;
            font: inherit;
            vertical-align: baseline;
        }
        /* HTML5 display-role reset for older browsers */
        article, aside, details, figcaption, figure, 
        footer, header, hgroup, menu, nav, section {
            display: block;
        }
        body {
            line-height: 1;
        }
        ol, ul {
            list-style: none;
        }
        blockquote, q {
            quotes: none;
        }
        blockquote:before, blockquote:after,
        q:before, q:after {
            content: '';
            content: none;
        }
        table {
            border-collapse: collapse;
            border-spacing: 0;
        }
    </style>

    <style>
        :root {
            --tg-viewport-height: 100vh; 
            --tg-viewport-stable-height: 100vh;
        }

        * {
            box-sizing: border-box;
        }

        html, body {
            flex: 1 1 auto;
            display: flex;
            flex-direction: column;
            height: var(--tg-viewport-height);
        }

        body {
            background: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            font-family: Roboto, -apple-system, "apple color emoji", BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
            font-size: 16px;
        }

        .hint {
            color: var(--tg-theme-hint-color);
        }

        .accent {
            color: var(--tg-theme-accent-text-color);
        }

        .destructive {
            color: var(--tg-theme-destructive-text-color);
        }

        a {
            color: var(--tg-theme-link-color) !important;
        }

        .safe {
            margin-top: var(--tg-safe-area-inset-top);
            margin-left: var(--tg-safe-area-inset-left);
            margin-right: var(--tg-safe-area-inset-right);
            margin-bottom: var(--tg-safe-area-inset-bottom);
        }

        .section {
            padding: 0.75rem 1rem;
        }

        .section-header {
            display: block;
            margin-top: 0.25rem;
            margin-bottom: 0.5rem;
            color: var(--tg-theme-section-header-text-color);
            font-size: 0.75rem;
            font-weight: 500;
        }

        .section-content {
            padding: 1rem;
            border-radius: 10px;
            background-color: var(--tg-theme-section-bg-color);
            background-color: var(--tg-theme-secondary-bg-color) !important;
        }

        .section-separator {
            width: 100%;
            height: 1px;
            background-color: var(--tg-theme-section-separator-color);
        }

        .scrollable {
            width: 100%;
            height: 100%;
            overflow-y: hidden;
            overflow-x: hidden;
            max-height: 100%;
            position: absolute;
            inset: 0;
            -webkit-overflow-scrolling: touch;

            flex: 1 1 auto;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-y: overlay;
            scrollbar-width: none;
        }

        .button {
            display: block;
            flex: 0 0 auto;
            width: auto;
            height: 3rem;
            padding: 0;
            border-radius: 10px;
            text-align: center;
            border: none;
            font-weight: bold;
            background-color: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
        }

        .header {
            background-color: var(--tg-theme-header-bg-color);
        }

        .bottom-bar {
            width: 100%;
            display: flex;
            padding: 1rem;
            background-color: var(--tg-theme-bottom-bar-bg-color);
        }

        .bottom-bar .button {
            width: 100%;
            flex: 1;
        }

        .input-holder, #getaddress_dropdown {
            border: none;
            border-radius: 8px;
            height: 2.5rem;
            background: var(--tg-theme-bottom-bar-bg-color);
            background: var(--tg-theme-section-separator-color);
            background: var(--tg-theme-bg-color);
            display: flex;
            width: 100%;
            overflow: hidden;
        }

        .input-holder > * {
            height: 100%;
            background: none;
        }

        .input-holder > .input-button {
            cursor: pointer;
            display: block;
            padding: 0.875rem;
            font-size: 0.875rem;
            font-weight: bold;
        }

        .input-holder > input {
            width: 100%;
        }

        input, select {
            flex: 1;
            border: none;
            padding: 0;
            margin: 0;
            font-size: 0.875rem;
            padding: 0.875rem;
            color: var(--tg-theme-text-color);
            border-radius: 8px;
        }

        input::placeholder {
            color: var(--tg-theme-section-header-text-color);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(1, 1fr);
            gap: 1rem;
        }

        #getaddress_input, #getaddress_button {
            display: none;
        }

        select {
            padding: 0 0.875rem !important;
            display: block;
            margin-top: 1rem;
            max-width: 100%;
            padding-right: 3rem;
            -webkit-appearance: none;
            appearance: none;
            border: none;
        }
    </style>

    <script src="https://unpkg.com/imask"></script>
</head>
<body>
    <script>
        const data = {
            "country": "UK",
            "city": "London",
            "street": "test",
            "postal_code": "11111"
        }
    </script>

    <form onsubmit="submit">
        <div class="scrollable">
            <div class="section">
                <div class="section-header">CONTACT INFORMATION</div>
                <div class="section-content">
                    <div class="grid">
                        <div class="input-holder">
                            <input type="text" name="first_name" placeholder="First Name" required>
                        </div>
                        <div class="input-holder">
                            <input type="text" name="last_name" placeholder="Last Name" required>
                        </div>
                        <div class="input-holder">
                            <input type="text" name="phone" id="phone" placeholder="Phone Number" required>
                        </div>
                        <div class="input-holder">
                            <input type="email" name="email" placeholder="Email" required>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">SHIPPING ADDRESS</div>
                <div class="section-content secondary-bg">
                    <div class="input-holder" style="display: flex">
                        <input id="postcode" type="text" name="postcode" placeholder="Postcode" required>
                        <span id="find-button" class="input-button accent">Find Address</span>
                    </div>

                    <div id="postcode_lookup"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-content secondary-bg">
                    <div class="grid">
                        <div class="input-holder" style="grid-column: span 2 / span 2;">
                            <input id="country" type="text" name="country" placeholder="Country">
                        </div>

                        <div class="input-holder" style="grid-column: span 2 / span 2;">
                            <input id="district" type="text" name="city" placeholder="Town / City" required>
                        </div>

                        <div class="input-holder">
                            <input id="line_1" type="text" name="line_1" placeholder="Street name and house number" required>
                        </div>

                        <div class="input-holder">
                            <input id="line_2" type="text" name="line_2" placeholder="Suit, unit, etc.">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="bottom-bar">
            <button type="submit" class="button">SUBMIT</button>
            <!-- <button class="button" onclick="window.Telegram.WebApp.sendData(JSON.stringify(data))">SUBMIT</button> -->
        </div>
    </form>

    <script>
        submit(e => {
            window.Telegram.WebApp.showAlert('The form information is incorrect. Please complete all required fields.')
        })
    </script>

    <script src="https://cdn.getaddress.io/scripts/getaddress-3.0.17.min.js"></script>
    <script>
        document.getElementById('find-button').addEventListener('click', function (e) {
            let value = document.getElementById('postcode').value;

            e.target.innerHTML = "Loading..."
            e.target.setAttribute("disabled", true)

            document.getElementById('getaddress_input').value = value;
            document.getElementById('getaddress_button').click();
        })

        getAddress.find(
            'postcode_lookup',
            'lVPlVrR5SEG7AMTYzqTBgQ48741',
            {
                output_fields: {
                    input: {
                        id: 'getaddress_input'
                    },
                    button:{
                        id: 'getaddress_button',
                    },
                    dropdown:{
                        id: 'getaddress_dropdown',
                    },
                    error_message:{
                        id: 'getaddress_error_message',
                    },
                }
            },
        );

        document.addEventListener("getaddress-find-suggestions", function(e){
            let button = document.getElementById('find-button');

            button.innerHTML = "Find Address";
            button.removeAttribute("disabled")
            console.log(e.suggestions);
        })

        document.addEventListener("getaddress-find-suggestions-failed", function(e){
            console.log(e.status);
            console.log(e.message);
        })

        document.addEventListener("getaddress-find-address-selected", function(e){
            console.log(e.address);
        })

        document.addEventListener("getaddress-find-address-selected-failed", function(e){
            console.log(e.status);
            console.log(e.message);
        })
    </script>

    <script>
        const element = document.getElementById('phone');
        const maskOptions = {
            mask: [
                { mask: '+{44} 0000 000000' },
                { mask: '+{44} 000 0000 0000' },
                { mask: '+{44} 00 0000 0000' },
            ]
        };
        const mask = IMask(element, maskOptions);
    </script>
</body>
</html>